!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.imageEditor=e():t.imageEditor=e()}(self,(()=>(()=>{"use strict";var t={958:(t,e,s)=>{s.d(e,{Z:()=>r});var o=s(81),a=s.n(o),i=s(645),n=s.n(i)()(a());n.push([t.id,".test{color:red}\n",""]);const r=n},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var s="",o=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),o&&(s+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),s+=t(e),o&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s})).join("")},e.i=function(t,s,o,a,i){"string"==typeof t&&(t=[[null,t,void 0]]);var n={};if(o)for(var r=0;r<this.length;r++){var h=this[r][0];null!=h&&(n[h]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);o&&n[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),s&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=s):c[2]=s),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),e.push(c))}},e}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function s(t){for(var s=-1,o=0;o<e.length;o++)if(e[o].identifier===t){s=o;break}return s}function o(t,o){for(var i={},n=[],r=0;r<t.length;r++){var h=t[r],l=o.base?h[0]+o.base:h[0],c=i[l]||0,d="".concat(l," ").concat(c);i[l]=c+1;var u=s(d),m={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==u)e[u].references++,e[u].updater(m);else{var v=a(m,o);o.byIndex=r,e.splice(r,0,{identifier:d,updater:v,references:1})}n.push(d)}return n}function a(t,e){var s=e.domAPI(e);return s.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,a){var i=o(t=t||[],a=a||{});return function(t){t=t||[];for(var n=0;n<i.length;n++){var r=s(i[n]);e[r].references--}for(var h=o(t,a),l=0;l<i.length;l++){var c=s(i[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}i=h}}},569:t=>{var e={};t.exports=function(t,s){var o=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(s)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,s)=>{t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var o="";s.supports&&(o+="@supports (".concat(s.supports,") {")),s.media&&(o+="@media ".concat(s.media," {"));var a=void 0!==s.layer;a&&(o+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),o+=s.css,a&&(o+="}"),s.media&&(o+="}"),s.supports&&(o+="}");var i=s.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function s(o){var a=e[o];if(void 0!==a)return a.exports;var i=e[o]={id:o,exports:{}};return t[o](i,i.exports,s),i.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.nc=void 0;var o={};return(()=>{s.r(o),s.d(o,{init:()=>g});var t=s(379),e=s.n(t),a=s(795),i=s.n(a),n=s(569),r=s.n(n),h=s(565),l=s.n(h),c=s(216),d=s.n(c),u=s(589),m=s.n(u),v=s(958),p={};p.styleTagTransform=m(),p.setAttributes=l(),p.insert=r().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=d(),e()(v.Z,p),v.Z&&v.Z.locals&&v.Z.locals;class f{constructor(t,e){this.parentEl=t,this.parentEl.style.position="relative",this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.heigt="100%",this.canvas.style.backgroundColor="#f2f2f2",this.canvas.style.borderRadius="4px",this.canvas.style.border="1px solid #d3d3d3",this.parentEl.appendChild(this.canvas),this.context=this.canvas.getContext("2d");let s=this.canvas.getBoundingClientRect();this.canvas.height=s.height,this.canvas.width=s.width,this.left=s.left,this.top=s.top,this.state={moveMode:"full",zoom:1,offset:{x:this.canvas.width/2,y:this.canvas.height/2},paths:[],background:{image:new Image,x:0,y:0}},this.state.background.image.src=e,this.state.background.x=this.canvas.width/2-this.state.background.image.width/2,this.state.background.y=this.canvas.height/2-this.state.background.image.height/2,this.state.background.image.style.display="none",this.parentEl.appendChild(this.state.background.image),this.tools={move:{active:!0,moving:!1,lastDraw:new Date,mouseDown:{x:0,y:0}},draw:{active:!1,moving:!1,lineWidth:5,color:"red",lastDraw:new Date,mouseDown:{x:0,y:0}}},this.draw(),this.setControls(),this.setFullSize()}translateCoordinates(t,e){return{x:t*this.state.zoom+this.state.offset.x+this.state.offset.x*this.state.zoom,y:e*this.state.zoom+this.state.offset.y+this.state.offset.y*this.state.zoom}}draw(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.state.background.image.width*this.state.zoom,e=this.state.background.image.height*this.state.zoom;this.context.drawImage(this.state.background.image,0,0,t,e);for(let t in this.state.paths)for(let e in this.state.paths[t]){const s=this.state.paths[t][parseInt(e)],o=this.state.paths[t][parseInt(e)+1];if(o){this.context.strokeStyle=this.tools.draw.color,this.context.lineWidth=this.tools.draw.lineWidth,this.context.beginPath();const t=this.translateCoordinates(s.x,s.y);this.context.moveTo(t.x,t.y);const e=this.translateCoordinates(o.x,o.y);this.context.lineTo(e.x,e.y),this.context.stroke()}}this.drawTools()}drawTools(){let t=this.parentEl.querySelector(".toolbox");t&&t.remove();let e=this.parentEl.querySelector(".setting");e&&e.remove();let s=document.createElement("div");s.classList.add("toolbox"),s.style.position="absolute",s.style.top="0px",s.style.left="0px";let o=document.createElement("button");o.innerText="move",this.tools.move.active?o.style.backgroundColor="red":o.style.backgroundColor="unset",o.addEventListener("click",(t=>{console.log("move"),this.tools.move.active=!0,this.tools.draw.active=!1,this.draw()})),s.appendChild(o);let a=document.createElement("button");a.innerText="draw",this.tools.draw.active?a.style.backgroundColor="red":a.style.backgroundColor="unset",a.addEventListener("click",(t=>{console.log("draw"),this.tools.move.active=!1,this.tools.draw.active=!0,this.draw()})),s.appendChild(a);let i=document.createElement("div");s.classList.add("settings"),i.style.position="absolute",i.style.top="0px",i.style.right="0px";let n=document.createElement("button");n.innerText="zoom",n.addEventListener("click",(t=>{"custom"==this.state.moveMode||"normal"==this.state.moveMode?(this.state.moveMode="full",this.setFullSize()):(this.state.moveMode="normal",this.setNormalSize())})),i.appendChild(n),this.parentEl.appendChild(i),this.parentEl.appendChild(s)}setFullSize(){const t=(this.canvas.height-20)/this.state.background.image.height,e=(this.canvas.width-20)/this.state.background.image.width;this.state.zoom=Math.min(t,e),this.state.offset.x=0,this.state.offset.y=0,this.draw()}setNormalSize(){this.state.zoom=1,this.state.offset.x=0,this.state.offset.y=0,this.draw()}coordsOnImage(t,e){return t>=this.state.offset.x+this.canvas.width/2-this.state.background.image.width*this.state.zoom/2&&t<=this.state.offset.x+this.canvas.width/2+this.state.background.image.width*this.state.zoom/2&&e>=this.state.offset.y+this.canvas.height/2-this.state.background.image.width*this.state.zoom/2&&e<=this.state.offset.y+this.canvas.height/2+this.state.background.image.width*this.state.zoom/2}async getBlob(){this.canvas.toBlob((t=>{t.text().then((t=>t))}),"image/jpeg",.95)}setControls(){this.parentEl.addEventListener("wheel",(t=>{this.state.moveMode="custom";const e=t.deltaY/1e3+1;this.state.zoom=this.state.zoom*e,this.draw()})),this.parentEl.addEventListener("mousedown",(t=>{this.coordsOnImage(t.x,t.y)&&(this.tools.move.active&&(this.tools.move.moving=!0,this.canvas.style.cursor="grabbing",this.tools.move.mouseDown.x=t.x,this.tools.move.mouseDown.y=t.y),this.tools.draw.active&&(this.tools.draw.moving=!0,this.state.paths.push([])))})),this.parentEl.addEventListener("mouseup",(t=>{this.tools.move.active&&this.tools.move.moving&&(this.tools.move.moving=!1,this.canvas.style.cursor="auto",this.state.moveMode="custom",this.draw()),this.tools.draw.active&&this.tools.draw.moving&&(this.tools.draw.moving=!1,this.draw())})),this.parentEl.addEventListener("mousemove",(t=>{if(this.tools.move.active)if(this.tools.move.moving){if(new Date-this.tools.move.lastDraw>=20){this.tools.move.lastDraw=new Date;const e=t.x-this.tools.move.mouseDown.x,s=t.y-this.tools.move.mouseDown.y;this.tools.move.mouseDown.x=t.x,this.tools.move.mouseDown.y=t.y,this.state.offset.x+=e,this.state.offset.y+=s,this.draw()}}else this.coordsOnImage(t.x,t.y)?this.canvas.style.cursor="grab":this.canvas.style.cursor="auto";if(this.tools.draw.active&&this.tools.draw.moving)if(this.coordsOnImage(t.x,t.y)){if(new Date-this.tools.draw.lastDraw>=20){this.tools.draw.lastDraw=new Date;const e=(t.x-this.left-this.state.offset.x)/this.state.zoom,s=(t.y-this.top-this.state.offset.y)/this.state.zoom;this.state.paths[this.state.paths.length-1].push({x:e,y:s}),this.draw()}}else this.tools.draw.moving=!1,this.draw()}))}}function g(t,e){return new f(t,e)}})(),o})()));